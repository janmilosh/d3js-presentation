<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3.js Demo</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="wrapper">

<!-- Title page -->
  <h1>Introduction<br>to<br>Graphing<br>with<br>D3.js</h1>
  <h3>Jan Milosh&nbsp;&nbsp;<a href="http://janmilosh.com">janmilosh.com</a></h3>
  

<!-- What is D3.js --><hr>
  <h2>What is D3.js?</h2>
  <p>D3.js <a href="http://d3js.org">(d3js.org)</a> stands for Data-Driven Documents, a JavaScript library for data visualization. It was created by Mike Bostock, based on his PhD studies in the Stanford University data visualization program. Mike now works at the New York Times who sponsors his open source work.</p>
  <p>D3 was designed for more than just graphs and charts. It's also capable of presenting maps, networks, and ordered lists. This demonstration will focus on creating a simple scatter plot.</p>
  <h3>DOM and Data Binding</h3>
  <p>D3 provides the ability to select DOM elements and bind data to them (any kind of element, including images and text).</p>
  <p>The magic of D3 comes from the ability to use data and web page elements together. Elements can be selected and their appearance modified to reflect differences in the data.</p>
  <p>Note: D3 is designed for modern browsers that support HTML5 and CSS3 and requires utf-8 encoding.</p>


<!-- Getting started --><hr>
  <h2>Getting Started</h2>
  <p>First include the D3.js file which can be downloaded from <a href="d3js.org">d3js.org</a>, or linked through a CDN. I'll be using the downloaded file.</p>
  <p>My graph will be created with a script embedded in this html page. The D3.js file will be included before the graph script.</p>
  <p>We will be using SVG elements to create our graph, so we need to create an SVG canvas to contain it.</p>
  <p>Demo 1:</p>


  <script src="js/d3.min.js"></script>

  <svg id="demo-1" height="400" width="750" style="background: #444;"></svg>


<!-- Select, Append, and Chained Operators --><hr>
  <h2>Select, Append, and Chained Operators</h2>
  <p>D3.js has a <code>select()</code> method for grabbing DOM elements. Once selected, you can apply operators to these elements. This method selects the first element of that type.</p>
  <p>Operators can then be used to get or set items such as attributes, properties, styles, text, and html.</p>
  <p>D3 methods can be chained with a syntax much like jQuery.</p>
  <p>Each operator in the chain returns a selection and the next operator in the chain operates on that selection.</p>
  <p>Demo 2:</p>


  <div id="demo-2"></div>
  
  <script>
    var height = 400;
    var width = 750;
    var svgColor = '#444';

    var svgSelection = d3.select('#demo-2')
      .append('svg')
      .attr('height', height)
      .attr('width', width)
      .style('background', svgColor);

    svgSelection.append('circle')
      .attr("cx", 380)
      .attr("cy", 200)
      .attr("r", 100)
      .style("fill", "white");

    svgSelection.append('circle')
      .attr("cx", 360)
      .attr("cy", 180)
      .attr("r", 50)
      .style("fill", "orange");
  </script>


<!-- Binding Data to the SVG --><hr>
  <h2>Binding Data to the SVG</h2>
  <p>D3.js can load data from a number of types of external resources. These include CSV, TSV, JSON, and XML. We just need to ultimately construct an array from the data. For now we'll use an array of JSON objects.</p>
  <p>There are several methods required for for binding data points to our graph (I've chosen to represent the data with circles):</p>
  <p><code>selectAll('circle')</code> - selects all circles in our SVG and returns an empty array if there aren't any yet.</p>
  <p><code>data(dataArray)</code> - this joins an array of data to the current selection.</p>
  <p><code>enter()</code> - joins the data to placeholders for the circles.</p>
  <p><code>append('circle')</code> - appends the circles to the SVG.</p>
  <p>Mike Bostock has a pretty good explanation of this <a href="http://bost.ocks.org/mike/join/">here</a>.</p>
  <p>Demo 3:</p>


  <div id="demo-3"></div>
  
  <script>
    var dataArray = [
      {x: 5, y: 10, color: 'red'},
      {x: 8, y: 10, color: 'orange'},
      {x: 9, y: 13, color: 'pink'},
      {x: 16, y: 3, color: 'violet'},
      {x: 6, y: 9, color: 'lightgreen'},
      {x: 3, y: 4,color: 'yellow'},
      {x: 7, y: 5, color: 'lightblue'}
    ];

    var height = 400;
    var width = 750;
    var svgColor = '#444';

    var svgSelection = d3.select('#demo-3')
      .append('svg')
      .attr('height', height)
      .attr('width', width)
      .style('background', svgColor);

    var dataPoints = svgSelection
      .selectAll('circle')
      .data(dataArray)
      .enter()
      .append('circle');

    var dataAttributes = dataPoints
      .attr('cx', function (d) { return d.x; })
      .attr('cy', function(d) { return d.y; })
      .attr('r', 15)
      .attr('fill', function(d) { return d.color; });
  </script>


<!-- Scaling our Data --><hr>
  <h2>Scaling our Data</h2>
  <p>We need to scale our data to fit the space available. D3 provides functions to help us do this. There are different scale types available, but for this example we'll use a linear scale, <code>d3.scale.linear()</code>. We need to specify a domain and range. The domain refers to the data and the range refers to the SVG space.</p>
  <p>Demo 4:</p>


  <div id="demo-4"></div>
  
  <script>
    var dataArray = [
      {x: 5, y: 10, color: 'red'},
      {x: 8, y: 10, color: 'orange'},
      {x: 9, y: 13, color: 'pink'},
      {x: 16, y: 3, color: 'violet'},
      {x: 6, y: 9, color: 'lightgreen'},
      {x: 3, y: 4,color: 'yellow'},
      {x: 7, y: 5, color: 'lightblue'}
    ];

    var height = 400;
    var width = 750;
    var svgColor = '#444';

    var xScale = d3.scale.linear()//adds xScale
      .domain([0, 16])
      .range([0, width]);

    var yScale = d3.scale.linear()//adds yScale
      .domain([0, 13])
      .range([0, height]);

    var svgSelection = d3.select('#demo-4')
      .append('svg')
      .attr('height', height)
      .attr('width', width)
      .style('background', svgColor);

    var dataPoints = svgSelection
      .selectAll('circle')
      .data(dataArray)
      .enter()
      .append('circle');

    var dataAttributes = dataPoints
      .attr('cx', function (d) { return xScale(d.x); }) //x values are scaled
      .attr('cy', function(d) { return height - yScale(d.y); })//y values are scaled
      .attr('r', 15)                                          //and measured from bottom
      .attr('fill', function(d) { return d.color; });
  </script>


<!-- Make data scaling more dynamic --><hr>
  <h2>Make Data Scaling More Dynamic</h2>
  <p>So far we've hard coded our domain, but it would be better to have D3 help us determine our domain by calculating the max and min for our data using the <code>d3.max()</code> and <code>d3.min()</code> methods.</p>
  <p>Demo 5:</p>


  <div id="demo-5"></div>
  
  <script>
    var dataArray = [
      {x: 5, y: 10, color: 'red'},
      {x: 8, y: 10, color: 'orange'},
      {x: 9, y: 13, color: 'pink'},
      {x: 16, y: 3, color: 'violet'},
      {x: 6, y: 9, color: 'lightgreen'},
      {x: 3, y: 4,color: 'yellow'},
      {x: 7, y: 5, color: 'lightblue'}
    ];

    var height = 400;
    var width = 750;
    var svgColor = '#444';

    var maxX = d3.max(dataArray, function(d) { return d.x; });
    var minX = d3.min(dataArray, function(d) { return d.x; });
    var maxY = d3.max(dataArray, function(d) { return d.y; });
    var minY = d3.min(dataArray, function(d) { return d.y; });

    var xScale = d3.scale.linear() 
      .domain([minX, maxX])
      .range([0, width]);

    var yScale = d3.scale.linear()
      .domain([minY, maxY])
      .range([0, height]);

    var svgSelection = d3.select('#demo-5')
      .append('svg')
      .attr('height', height)
      .attr('width', width)
      .style('background', svgColor);

    var dataPoints = svgSelection
      .selectAll('circle')
      .data(dataArray)
      .enter()
      .append('circle');

    var dataAttributes = dataPoints
      .attr('cx', function (d) { return xScale(d.x); })
      .attr('cy', function(d) { return height - yScale(d.y); })
      .attr('r', 15)
      .attr('fill', function(d) { return d.color; });
  </script>


<!-- Add Labels to the Data Points --><hr>
  <h2>Add Labels to the Data Points</h2>
  <p>We can use the SVG text element to add labels to our data points. The text is appended just like the other elements.</p>
  <p>Demo 6:</p>


  <div id="demo-6"></div>
  
  <script>
    var dataArray = [
      {x: 5, y: 10, color: 'red'},
      {x: 8, y: 10, color: 'orange'},
      {x: 9, y: 13, color: 'pink'},
      {x: 16, y: 3, color: 'violet'},
      {x: 6, y: 9, color: 'lightgreen'},
      {x: 3, y: 4,color: 'yellow'},
      {x: 7, y: 5, color: 'lightblue'}
    ];

    var height = 400;
    var width = 750;
    var svgColor = '#444';

    var maxX = d3.max(dataArray, function(d) { return d.x; });
    var minX = d3.min(dataArray, function(d) { return d.x; });
    var maxY = d3.max(dataArray, function(d) { return d.y; });
    var minY = d3.min(dataArray, function(d) { return d.y; });

    var xScale = d3.scale.linear()
      .domain([minX, maxX])
      .range([0, width]);

    var yScale = d3.scale.linear()
      .domain([minY, maxY])
      .range([0, height]);

    var svgSelection = d3.select('#demo-6')
      .append('svg')
      .attr('height', height)
      .attr('width', width)
      .style('background', svgColor);

    var dataPoints = svgSelection
      .selectAll('circle')
      .data(dataArray)
      .enter()
      .append('circle');

    var dataAttributes = dataPoints
      .attr('cx', function (d) { return xScale(d.x); })
      .attr('cy', function(d) { return height - yScale(d.y); })
      .attr('r', 15)
      .attr('fill', function(d) { return d.color });

    var text = svgSelection
      .selectAll('text')
      .data(dataArray)
      .enter()
      .append('text');

    var dataLabels = text
      .attr('x', function(d) { return xScale(d.x) + 15; })
      .attr('y', function(d) { return height - yScale(d.y) - 15; })
      .text( function (d) { return d.x + ', ' + d.y; })
      .attr('font-family', 'helvetica')
      .attr('font-size', '16px')
      .attr('fill', function(d) { return d.color }); 
  </script>


<!-- Add Some Margin --><hr>
  <h2>Add Some Margin</h2>
  <p>Our elements are hanging over the edge of our SVG, so we need some margin. This will also provide room for axes. We need to do this in a way that keeps our data normalized. Thanks to <a href="https://egghead.io/lessons/d3-margins">egghead.io</a> for the margins tutorial.</p>
  <p>Demo 7:</p>


  <div id="demo-7"></div>
  
  <script>
    var dataArray = [
      {x: 5, y: 10, color: 'red'},
      {x: 8, y: 10, color: 'orange'},
      {x: 9, y: 13, color: 'pink'},
      {x: 16, y: 3, color: 'violet'},
      {x: 6, y: 9, color: 'lightgreen'},
      {x: 3, y: 4,color: 'yellow'},
      {x: 7, y: 5, color: 'lightblue'}
    ];

    var margin = {top: 50, right: 75, bottom: 50, left: 50}; //sets the margin values
    var height = 400 - margin.top - margin.bottom; //subtracts top and bottom margins
    var width = 750 - margin.left - margin.right; //subtracts left and right margins
    var svgColor = '#444';

    var maxX = d3.max(dataArray, function(d) { return d.x; });
    var minX = d3.min(dataArray, function(d) { return d.x; });
    var maxY = d3.max(dataArray, function(d) { return d.y; });
    var minY = d3.min(dataArray, function(d) { return d.y; });

    var xScale = d3.scale.linear()
      .domain([minX, maxX])
      .range([0, width]);

    var yScale = d3.scale.linear()
      .domain([minY, maxY])
      .range([0, height]);

    var svgSelection = d3.select('#demo-7')
      .append('svg')
      .style('background', svgColor) //had to move this up as it needs to act on svg, not the group
      .attr('height', height + margin.top + margin.bottom) //add margins to svg height
      .attr('width', width + margin.left + margin.right) //add mirgins to svg width
      .append('g')                                        //this is so we can translate
      .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')'); //move the svg back into position
      
    var dataPoints = svgSelection
      .selectAll('circle')
      .data(dataArray)
      .enter()
      .append('circle');

    var dataAttributes = dataPoints
      .attr('cx', function (d) { return xScale(d.x); })
      .attr('cy', function(d) { return height - yScale(d.y); })
      .attr('r', 15)
      .attr('fill', function(d) { return d.color });

    var text = svgSelection
      .selectAll('text')
      .data(dataArray)
      .enter()
      .append('text');

    var dataLabels = text
      .attr('x', function(d) { return xScale(d.x) + 15; })
      .attr('y', function(d) { return height - yScale(d.y) - 15; })
      .text( function (d) { return d.x + ', ' + d.y; })
      .attr('font-family', 'helvetica')
      .attr('font-size', '16px')
      .attr('fill', function(d) { return d.color }); 
  </script>


<!-- References --><hr>
  <h2>References</h2>
  <p><a href="https://www.dashingd3js.com">www.dashingd3js.com</a> has a detailed tutorial (up to the point of adding axes).</p>

</div>
</body>
</html>